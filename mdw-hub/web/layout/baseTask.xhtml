<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html 
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:t="http://myfaces.apache.org/tomahawk"
  xmlns:mdw="http://www.centurylink.com/mdw/jsf"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:a4j="http://richfaces.org/a4j"
  xmlns:hub="http://www.centurylink.com/mdw-hub/jsf">

  <ui:composition template="/layout/detail.xhtml">

    <ui:param
      name="layoutWidth"
      value="960" />

    <ui:define name="detailHeader">
      Task #{task.id} -- #{task.name}
    </ui:define>
      
    <ui:define name="detailLinks">
      <hub:taskNav />
    </ui:define>

    <ui:define name="detailContent">
      <ui:insert name="taskSummary">
        <ui:include src="../tasks/taskSummary.xhtml" />
      </ui:insert>
      
      <ui:insert name="taskMessage">
        <mdw:panel id="taskMessagePanel" rendered="#{task.message != null}" label="Task Message" collapsible="true" styleClass="mdw_panel">
          <t:panelGroup>
            <pre style="padding:0;margin:0;">
              <t:outputText id="message" value="#{task.message}" escape="true" /></pre>
          </t:panelGroup>
        </mdw:panel>
      </ui:insert>
      
      <ui:insert name="customContent" />
    
      <ui:insert name="taskData">
        <ui:include src="../tasks/taskData.xhtml" />
      </ui:insert>
      
    </ui:define>

    <ui:define name="actionContent">
      <h:panelGroup
        layout="block"
        rendered="#{(detailManager.taskDetail.taskAssignedToCurrentUser || detailManager.taskDetail.applicableForCurrentUsersWorkgroups) &amp;&amp; detailManager.taskDetail.anyValidTaskActions}">
        <!-- TODO: subformId, actionFor, and optionalValidation are not used.
             Check whether these were needed to provide AutoSave functionality (see TaskAction.decode())
             Avoid using subforms if possible -->
        <t:inputHidden
          id="taskInstanceId" 
          immediate="true" 
          forceId="true" 
          name="taskInstanceId" 
          value="#{detailManager.taskDetail.instanceId}"/> 
        <div style="float:left;]">
          <rich:dropDownMenu 
            binding="#{detailManager.taskDetail.taskActionMenu}"
            mode="ajax"
            target="#{detailManager.taskDetail}"
            subformId="detailForm"
            actionFor="mainDetailForm:actionForm,mainDetailForm:detailForm"
            optionalValidation="mainDetailForm:detailForm"
            hideDelay="200"
            popupWidth="110"
            jointPoint="bottomRight"
            direction="topRight">
            <f:facet name="label">
              <h:commandButton
                value="Actions >"
                type="button" 
                onclick="return false;"
                styleClass="mdw_detailFormButtons"
                style="margin: 3px 0 0 0;" />
            </f:facet>
          </rich:dropDownMenu>
        </div>
        <ui:include src="/components/html5/actionComment.xhtml" />
      </h:panelGroup>     
    </ui:define>

    <ui:define name="commandContent">
      <div style="float:right;">
        <h:commandButton
          id="taskDetailSave"
          rendered="#{task.assignee == authenticatedUser.cuid &amp;&amp; !task.inFinalStatus}"
          value="Save"
          action="go_taskDetail"
          actionFor="detailForm"
          styleClass="mdw_detailFormButtons">
          <f:actionListener
            type="com.centurylink.mdw.taskmgr.ui.tasks.detail.TaskInstanceActionController">
          </f:actionListener>
          <f:param name="taskInstanceId" value="#{detailManager.taskDetail.instanceId}" />
        </h:commandButton>
      </div>
    </ui:define>

  </ui:composition>

</html>