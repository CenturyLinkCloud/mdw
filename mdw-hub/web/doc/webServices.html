<html>
<head>
<title>MDW Web Services</title>
<link rel="stylesheet" type="text/css" href="docstyle.css"/>
<link rel="stylesheet" type="text/css" href="doc/docstyle.css"/>
</head>
<body>
<h1>MDW Web Services</h1>
<p>
The MDW framework provides a platform for deploying and consuming two different types of Web Services: 
simple RESTful services and traditional SOAP-based services.
Using either protocol, you can leverage MDW to invoke a service from within your workflow process,
or to expose a service that's implemented as a realtime workflow process.
</p>
<p>
<a href="http://en.wikipedia.org/wiki/Representational_State_Transfer">REST</a> services require less 
overhead and are easier to implement.
<a href="http://en.wikipedia.org/wiki/SOAP_(protocol)">SOAP</a>-based services provide compatibility 
with established industry standard web service protocols.
Either way, if you follow the MDW patterns (ExternalEventHandlers for incoming service requests, and Adapters for outgoing service requests)
then you don't have to concern yourself with protocol-specific aspects to build a service-oriented workflow.
If you <i>do</i> feel like diving into the underlying protocol details, you can refer to the MDW 
<a href="listener.html">Listener</a> or <a href="AdapterActivityBase.html">Adapter</a> documentation, or the MDWFramework source code.
</p>
<h3>Exposing Web Services</h3>
<p>
Just as for all supported protocols, you can create and register Web Service Handlers using the MDW Plug-In External Event wizard 
(File &gt; New &gt; Other &gt; MDW Event Handlers &gt; External Event Handler).
Your handler is registered to respond to a specified incoming document content (the <a href="xpath.html">Message Pattern</a>), 
regardless of how the message was received (SOAP, REST, JMS, BUS, etc).
Typically you'll choose to launch a <a href="process.html">Service Process</a> which is responsible for handling the request 
and generating a response in real-time.  However, you can also choose to implement a custom handler that can perform actions such as parsing the 
request before launching a process, or can generate a response without involving a workflow process at all.
If you choose a custom handler, a reasonable skeleton implementation is generated by the wizard, and its handleEventMessage() method 
will be automatically invoked whenever a matching request message is received.
</p> 
<h4>REST</h4>
<p>
Since the payload of a RESTful service is typically a standalone XML document, this is what's used to compare against the registered message pattern.
By default it's also made available in your service process flow via the implicit "request" variable.
</p> 
<h4>SOAP</h4>
<p>
The incoming SOAP request consists of an XML document with a SOAP Envelope, optional Headers, and a SOAP Body.
In a document-literal style service (the type supported out-of-the-box by MDW) the SOAP Body contains a top-level XML schema type that 
comprises the message payload.  The MDW SOAP listener unpacks the message payload from the SOAP body and matches it against your event handler.
The SOAP headers are passed on in the protocol metadata to your custom event handler method.
</p>
<br/>
The steps for exposing an MDW Web Service based on a custom WSDL definition starting point are as follows:
<ul>
  <li>1. Create a WSDL document as a workflow asset.
  In the Eclipse Process Explorer view, right-click on a workflow package and select New &gt; XML Document.
  Type the document name, and select the language as "WSDL".
  When your server is running, the WSDL will be exposed via the standard MDW SOAP service endpoint URL 
  (such as: http://localhost:8181/MDWWeb/SOAP/Employee.wsdl)</li>
</ul>
   <img src="images/new_wsdl.jpg" style="margin-left:25px;" />
   <br/><br/>
   <div style="margin-left:20px;">Here's an example WSDL definition for a simple GetEmployee service:
   <br/>(the expression <i>${mdw.services.url}</i> is substituted at runtime with the corresponding value from the MDW configuration file)</div> 
<pre style="margin-left:25px;">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;wsdl:definitions
  name="wsdl-first"
  xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/"
  xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:tns="http://mdw-servicemix.centurylink.com"
  xmlns:typens="http://mdw-servicemix.centurylink.com/serviceTypes"
  targetNamespace="http://mdw-servicemix.centurylink.com"&gt;

  &lt;wsdl:types&gt;
    &lt;xsd:schema
      targetNamespace="http://mdw-servicemix.centurylink.com/serviceTypes"
      elementFormDefault="qualified"&gt;
      &lt;xsd:element name="GetEmployee"&gt;
        &lt;xsd:complexType&gt;
          &lt;xsd:sequence&gt;
            &lt;xsd:element
              name="sapId"
              type="xsd:string" /&gt;
          &lt;/xsd:sequence&gt;
        &lt;/xsd:complexType&gt;
      &lt;/xsd:element&gt;
      &lt;xsd:element name="GetEmployeeResponse"&gt;
        &lt;xsd:complexType&gt;
          &lt;xsd:sequence&gt;
            &lt;xsd:element
              name="sapId"
              type="xsd:string" /&gt;
            &lt;xsd:element
              name="firstName"
              type="xsd:string" /&gt;
            &lt;xsd:element
              name="lastName"
              type="xsd:string" /&gt;
          &lt;/xsd:sequence&gt;
        &lt;/xsd:complexType&gt;
      &lt;/xsd:element&gt;
      &lt;xsd:element name="UnknownEmployeeFault"&gt;
        &lt;xsd:complexType&gt;
          &lt;xsd:sequence&gt;
            &lt;xsd:element
              name="sapId"
              type="xsd:string" /&gt;
          &lt;/xsd:sequence&gt;
        &lt;/xsd:complexType&gt;
      &lt;/xsd:element&gt;
    &lt;/xsd:schema&gt;
  &lt;/wsdl:types&gt;

  &lt;wsdl:message name="GetEmployeeRequest"&gt;
    &lt;wsdl:part
      name="payload"
      element="typens:GetEmployee" /&gt;
  &lt;/wsdl:message&gt;
  &lt;wsdl:message name="GetEmployeeResponse"&gt;
    &lt;wsdl:part
      name="payload"
      element="typens:GetEmployeeResponse" /&gt;
  &lt;/wsdl:message&gt;
  &lt;wsdl:message name="UnknownEmployeeFault"&gt;
    &lt;wsdl:part
      name="payload"
      element="typens:UnknownEmployeeFault" /&gt;
  &lt;/wsdl:message&gt;

  &lt;wsdl:portType name="EmployeeLookup"&gt;
    &lt;wsdl:operation name="GetEmployee"&gt;
      &lt;wsdl:input message="tns:GetEmployeeRequest" /&gt;
      &lt;wsdl:output message="tns:GetEmployeeResponse" /&gt;
      &lt;wsdl:fault
        name="UnknownEmployee"
        message="tns:UnknownEmployeeFault" /&gt;
    &lt;/wsdl:operation&gt;
  &lt;/wsdl:portType&gt;

  &lt;wsdl:binding
    name="EmployeeSOAPBinding"
    type="tns:EmployeeLookup"&gt;
    &lt;soap:binding
      style="document"
      transport="http://schemas.xmlsoap.org/soap/http" /&gt;
    &lt;wsdl:operation name="GetEmployee"&gt;
      &lt;wsdl:input&gt;
        &lt;soap:body use="literal" /&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;soap:body use="literal" /&gt;
      &lt;/wsdl:output&gt;
      &lt;wsdl:fault name="UnknownEmployee"&gt;
        &lt;soap:fault
          use="literal"
          name="UnknownEmployee" /&gt;
      &lt;/wsdl:fault&gt;
    &lt;/wsdl:operation&gt;
  &lt;/wsdl:binding&gt;

  &lt;wsdl:service name="EmployeeService"&gt;
    &lt;wsdl:port
      binding="tns:EmployeeSOAPBinding"
      name="soap"&gt;
      &lt;soap:address location="${MDWFramework.MDWDesigner/services.url}/SOAP/Employee.wsdl" /&gt;
    &lt;/wsdl:port&gt;
  &lt;/wsdl:service&gt;

&lt;/wsdl:definitions&gt;
</pre>
<ul>
  <li>2. Create an External Event Handler to expose the service.
  In Eclipse Process Explorer view, right-click on the same package as above and select New &gt; External Event Handler.
  Designate a service process to handle the requests (or provide the class name for your generated custom handler).</li>
</ul>
  <img src="images/get_employee.jpg" style="margin-left:25px;" />  
<ul>
  <li>3. Use the MDW HTTP test tool to submit a SOAP request such as the following.</li>
</ul>
  <pre style="margin-left:25px;">
&lt;env:Envelope xmlns:env="http://schemas.xmlsoap.org/soap/envelope/"
              xmlns:tns="http://mdw-servicemix.centurylink.com/serviceTypes"&gt;
  &lt;env:Header&gt;
    &lt;trans:requestId xmlns:trans="http://www.centurylink.com/transaction/"&gt;12345678&lt;/trans:requestId&gt;
  &lt;/env:Header&gt;                    
  &lt;env:Body&gt;
    &lt;tns:GetEmployee&gt;
      &lt;tns:sapId&gt;DHO115360&lt;/tns:sapId&gt;
    &lt;/tns:GetEmployee&gt;
  &lt;/env:Body&gt;
&lt;/env:Envelope&gt;</pre>
  <img src="images/employee_request.jpg" style="margin-left:25px;" />  

<hr/><br/>
<h3>Consuming Web Services</h3>
You can use any of the pre-built Web Service adapter activities:
<ul>
  <li><a href="RestfulAdapter.html">RESTful Adapter</a> (for consuming REST-based services)</li>
  <li><a href="DocWebServiceAdapter.html">Document Web Service Adapter</a> ()For SOAP services with any document-literal style WSDL)</li>
  <li><a href="MDWWebServiceAdapter.html">MDW Web Service Adapter</a> (for SOAP services built on the MDW RPC-style WSDL)</li>
</ul> 
<hr/>
<br/><br/>
<h3>REST Services Framework</h3>
MDW comes with an extensible REST service framework that enables you to quickly expose your business logic
as an HTTP RESTful web service, supporting a payload of XML, JSON, or both.  In accordance with the REST
design paradigm, these services are categorized as either Resource Requests or Action Requests.  Resource
Requests are invoked through the HTTP GET method, while Action Requests use HTTP POST. 
<br/>
The REST framework comes with a general event handler that can automatically route a request to your custom service.
To host a Resource Request, you simply create a class that implements one or more of the following interfaces
(found in package com.centurylink.mdw.common.service):
<ul>
  <li>XmlService</li>
  <li>JsonService</li>
  <li>TextService</li>
</ul>
<p>
Consumers can access your service through a URL like the following (with a path equal to your fully-qualified class name):
</p>
<pre>http://localhost:8181/MDWWeb/Services/com.centurylink.myworkflow.MyResource</pre>
<p>
Similarly, here's an example POST request that will invoke your custom action handler (the action name is your service impl class):
</p>
<pre>
&lt;ActionRequest&gt;
  &lt;Action Name="com.centurylink.myworkflow.MyAction"&gt;
    &lt;Parameter name="myParam"&gt;This is going to do something cool.&lt;/Parameter&gt;
  &lt;/Action&gt;
&lt;/ActionRequest&gt;
</pre>
<p>
For manual unit-testing of your RESTful services you can post XML like this using the MDW Web HTTP Helper Tool.
</p>
<p>
If you've implemented your service using a Dynamic Java worklow asset, you can expose it as follows:
</p>
<pre>http://localhost:8181/MDWWeb/Services/MyWorkflowPackage/MyResource</pre>
<p>
If your app is deployed in an OSGi container, you can register your implementation as an OSGi service:
</p>
<pre>
  &lt;bean id="myCoolResource" class="com.centurylink.myworkflow.MyCoolResource" /&gt;
  &lt;osgi:service ref="myCoolResource"&gt;
    &lt;osgi:interfaces&gt;
      &lt;value&gt;com.centurylink.mdw.common.service.XmlService&lt;/value&gt;
    &lt;/osgi:interfaces&gt;
  &lt;/osgi:service&gt;
  &lt;osgi:service ref="myCoolResource"&gt;
    &lt;osgi:interfaces&gt;
      &lt;value&gt;com.centurylink.mdw.common.service.JsonService&lt;/value&gt;
    &lt;/osgi:interfaces&gt;
  &lt;/osgi:service&gt;  
</pre>
<p>
This registers as both an XML and JSON service, so in this case you'd implement both XmlService and JsonService.
Consumers can designate which response format they prefer by adding the parameter ?format=json (or xml) to their request URL.
</p>
<p>
The XSD covering ResourceRequests and ActionRequests is here:<br/>
<a href="http://cshare.ad.qintra.com/sites/MDW/Developer%20Resources/Environment/schemas/Services.xsd">http://cshare.ad.qintra.com/sites/MDW/Developer%20Resources/Environment/schemas/Services.xsd</a>.
</p>
<p>
Typically an ActionRequest needs to pass arbitrary XML or JSON content beyond the simple Parameter schema type (which is good for name/value pairs).
This payload is embedded in the Content element as in this example, which illustrates how a separate arbitrary XSD can be used to constrain the embedded payload:<br/>
<a href="http://cshare.ad.qintra.com/sites/MDW/Developer%20Resources/Environment/schemas/Samples/CreateTask.xml.xml">http://cshare.ad.qintra.com/sites/MDW/Developer%20Resources/Environment/schemas/Samples/CreateTask.xml</a>.
</p>
Alternatively, in MDW if you would like the custom payload to be the top-level element, you can register your EventHandler implementation through the usual channels (Camel or ExternalEvent), and the incoming document will be matched to your service according to the pattern specified in your EventHandler registration.

<h3>Standard REST Services</h3>
<p>
MDW provides some standard, extensible, RESTful services accessible via XML or JSON over HTTP.
These are listed in the <a href="../javadoc/index.html">MDW JavaDocs</a> under the following packages:
</p>
<p>
  <ul>
  <li><b>Resources:</b> <a href="../javadoc/com/centurylink/mdw/service/resource/package-summary.html">com.centurylink.mdw.service.resource</a></li>
  <li><b>Actions:</b> <a href="../javadoc/com/centurylink/mdw/service/action/package-summary.html">com.centurylink.mdw.service.action</a></li>
  </ul>
Sample requests for many of these services are available here:<br/>
<a href="http://cshare.ad.qintra.com/sites/MDW/Developer%20Resources/Environment/schemas/Samples">http://cshare.ad.qintra.com/sites/MDW/Developer%20Resources/Environment/schemas/Samples</a>.
</p>
<p>
Services are categorized into Resource Requests and Action Requests.
Resource Requests are implemented as HTTP GET requests with optional parameters passed on the URL.
They follow the convention that they are non-impactful; that is, they do not have any side-effects such as updating data.
The response to a Resource Request consists of an XML document whose XSD may be specific to the URL of the request.
</p>
<p>
For performing updates or other actions, Action Requests are utilized.  This is accomplished by submitting XML via HTTP POST.
The XML submitted for Action Requests should comply with the ActionRequest schema type in mdw-schemas/schemas/Services/Messages.xsd.
This schema type allows the submitter to specify the action to be performed and to pass arbitrary parameters as name/value pairs. 
The response XML for Action Requests is an MDWStatusMessage schema type which contains any applicable error messages.
</p>
To facilitate invoking the services from your code, the HttpHelper class is provided.  The following code snippet demonstrates its use:
<pre>
    String serviceUrl = "http://localhost:7001/MDWWeb/Services";
    
    ActionRequestDocument actionRequestDoc = ActionRequestDocument.Factory.newInstance();
    ActionRequest actionRequest = actionRequestDoc.addNewActionRequest();
    Action action = actionRequest.addNewAction();
    action.setName("RefreshProcessCache");
    
    HttpHelper httpHelper = new HttpHelper(new URL(serviceUrl));
    response = httpHelper.post(actionRequestDoc.xmlText());
    MDWStatusMessageDocument statusMessageDoc = MDWStatusMessageDocument.Factory.parse(response);
</pre>
<h3>Support for Basic Authentication</h3>
<p>MDW provides support for Basic Authentication in the following adapters and web services</p>
<h4>Outgoing adapters</h4>
<p>
The adapters below include configuration to set a user/password Basic Authentication combination that will be sent with each request  
</p>
<ul>
  <li><code>SoapWebServiceAdapter</code>
  </li>
  <li><code>DocumentWebServiceAdapter</code>
  </li>
  <li><code>RestfulServiceAdapter</code>
  </li>
</ul>
<p> For specific details on how to configure the above adapters for Basic Authentication, please refer to these adapters in the eclipse help.
</p>
<h4>Hosted web services</h4>
<p>
The MDW servlets below support HTTP Basic Authentication for hosted web services.  
</p>
<ul>
  <li><code>SoapListenerServlet</code>
  </li>
  <li><code>RestfulServicesServlet</code>
  </li>
 </ul>
<p>
To enable these servlets to use Basic authentication, you should set the following property in your <b>mdw.properties</b> or <b>com.centurylink.mdw.cfg</b> configuration file.
<br/><br/>
<code>mdw.http.listeners.auth.mode=Basic</code>
<br/><br/>
After authentication is successful, the authenticated username will be available in the metaInfo property "AuthenticatedUser" or Listener.AUTHENTICATED_USER_HEADER
</p>

</body>
</html>
