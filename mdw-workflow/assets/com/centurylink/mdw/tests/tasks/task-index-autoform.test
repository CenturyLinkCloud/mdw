// task-index-autoform
today = new Date()
start process("TaskIndexTesting") {
    variables = [ isCustom: false,
                  stringVar: 'before',
                  intVar: 101,
                  dateVar: today ]
}

sleep 30
def taskInst = action task("An AutoForm Task") {
    outcome = "Claim"
}

println 'verifying initial indexes for task instance id: ' + taskInst.getId()
def resp = get http("Services/Tasks/" + taskInst.getId() + "/indexes?format=json")

def indexes = new groovy.json.JsonSlurper().parseText(resp.getContent())
assert indexes.dateVarIndex == today.toString()
assert indexes.intVarIndex == "101"
assert indexes.stringVarIndex == "before"

laterToday = new Date()

action task("An AutoForm Task") {
    outcome = "Complete"
    variables = [ stringVar: 'after',
                  intVar: 1001,
                  dateVar: laterToday ]
}

sleep 30

println 'verifying updated for task instance id: ' + taskInst.getId()
resp = get http("Services/Tasks/" + taskInst.getId() + "/indexes?format=json")

indexes = new groovy.json.JsonSlurper().parseText(resp.getContent())
assert indexes.dateVarIndex == laterToday.toString()
assert indexes.stringVarIndex == "after"
assert indexes.intVarIndex == "1001"

verify process
