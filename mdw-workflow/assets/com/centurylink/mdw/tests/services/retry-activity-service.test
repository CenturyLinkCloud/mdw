// service-heteroproc-retry
masterRequestId = "tester-" + System.currentTimeMillis()

start process("FalloutTaskTest")
sleep 10  // process is not completed, can't wait for it


println 'Activity get Service'
def getResp = get http("Services/Activities/activityInstance/${masterRequestId}/FalloutTaskTest/A3?format=json")
activities = new groovy.json.JsonSlurper().parseText(getResp.getContent())
assert activities.activityInstances[0].activityId == 3

def actInst = activities.activityInstances[0].id


println 'Activity post Service'

def postReq = post http("Services/Activities/" + actInst + "/Retry?format=json") {
 user  = 'mdwapp'
 password = 'ldap_012'
 payload = "{}"
}

def postReq2 = post http("Services/Activities/" + actInst + "/Proceed?format=json") {
 user  = 'mdwapp'
 password = 'ldap_012'
 payload = "{}"
}

wait process
verify process("FalloutTaskTest")
