// service-heteroproc-proceed
masterRequestId = "tester-" + System.currentTimeMillis()

start process("com.centurylink.mdw.tests/MDWTestHeterogeneousProcessCall"){
	variables = [request:	"""\
<ser:ActionRequest xmlns:ser='http://mdw.centurylink.com/services'>
<Action Name="RegressionTest">
<Parameter name="MasterRequestId">${masterRequestId}</Parameter>
<Parameter name="ProcessName">MDWTestHeterogeneousProcessCall</Parameter>
<Parameter name="testcase">sequential</Parameter>
<Parameter name="PerformanceLevel">3</Parameter>
</Action>
</ser:ActionRequest>"""]
}

sleep 5

println 'Activity get Service'
def getResp = get http("Services/Activities/activityInstance/${masterRequestId}/MDWTestHeterogeneousProcessCall/A8?format=json")
activities = new groovy.json.JsonSlurper().parseText(getResp.getContent())
assert activities.activityInstances[0].activityId == 8

def actInst = activities.activityInstances[0].id

println 'Activity post Service'

def postReq = post http("Services/Activities/" + actInst + "/Proceed/sequential?format=json") {
 user  = 'mdwapp'
 password = 'ldap_012'
 payload = "{}"
}

wait process
verify processes("MDWTestHeterogeneousProcessCall", "MDWTestSubProcess3", "MDWTestSubProcess4")

