'use strict';

function loadPostman(path) {
  var fs = require('fs');
  var postman = JSON.parse(fs.readFileSync(path, 'utf8'));
  
  console.log('read postman test collection:\n ' + path);
  
  var requests = [];
  
  for (let i = 0; i < postman.item.length; i++) {
    let postmanItem = postman.item[i];
    var req = {
      url: postmanItem.request.url,
      method: postmanItem.request.method,
    };
    if (postmanItem.request.header) {
      req.header = {};
      for (let i = 0; i < postmanItem.request.header.length; i++) {
        var postmanHeader = postmanItem.request.header[i];
        req.header[postmanHeader.key] = postmanHeader.value;
      }
    }
    if (postmanItem.request.body && postmanItem.request.body.raw) {
      req.body = postmanItem.request.body.raw.replace(/\r/g, '');
    }
    requests.push(req);
  }
  
  return { name: postman.info.name, requests: requests };
};
