<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html 
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:t="http://myfaces.apache.org/tomahawk"
  xmlns:mdw="http://www.centurylink.com/mdw/jsf"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:a4j="http://richfaces.org/a4j">

  <ui:composition template="/facelets/layout/detail.xhtml">

    <ui:define name="detailLinks">
      <mdw:taskNav />
    </ui:define>

    <ui:define name="detailContent">
      <mdw:heading headingTitle="#{task.name}" />
      <div align="left">
      
        <ui:insert name="taskSummary">
          <rich:panel header="Task Summary" styleClass="mdw_defaultPanel" style="width:800px;">
            <t:panelGrid columns="6" width="100%" cellpadding="6" cellspacing="2" columnClasses="mdw_label,mdw_value,mdw_label,mdw_value,mdw_label,mdw_value">
              
              <h:outputLabel for="taskInstId" value="Task ID:" />
              <t:panelGroup>
                <h:outputText id="taskInstId" value="#{task.instanceId}" style="font-weight:bold" />
                <t:panelGroup rendered="#{task.subTask}">
                  <h:outputText value=" (subtask of "/>
                  <h:commandLink action="#{masterTaskActionController.displayMasterTaskInstance}">
                    <h:outputText value="#{task.masterTaskInstanceId}" />
                  </h:commandLink><h:outputText value=")" />
                </t:panelGroup>
              </t:panelGroup>
              
              <h:outputLabel for="taskStatus" value="Status:" />
              <h:outputText id="taskStatus" value="#{task.status}" styleClass="mdw_label" style="font-weight:bold" />
              
              <h:outputLabel for="assignee" value="Assignee:" />
              <h:outputText id="assignee" value="#{task.assigneeName}" style="font-weight:bold" />
              
              <h:outputLabel for="taskName" value="Task Name:" />
              <t:panelGroup colspan="5">
                <h:inputText id="taskName" value="#{task.name}" styleClass="mdw_value mdw_readOnly" style="width:605px;" readonly="true" />
              </t:panelGroup>
  
              <h:outputLabel for="orderId" value="Order ID:" />
              <h:outputText id="orderId" value="#{task.orderId}" />
              
              <h:outputLabel for="workgroups" value="WorkGroup(s):" />
              <t:panelGroup colspan="3">
                 <h:outputText id="workgroups" value="#{task.workgroups}" />
              </t:panelGroup>
  
              <h:outputLabel for="startDate" value="Started:" />
              <h:outputText id="startDate" value="#{task.startDate}" style="white-space:nowrap;">
                <f:convertDateTime pattern="MMM d, yyyy HH:mm" />
              </h:outputText>
              
              <!-- editable due date -->
              <h:outputLabel for="dueDate" value="Due:" rendered="#{task.assignee == authenticatedUser.cuid &amp;&amp; !task.inFinalStatus}" />
              <rich:calendar id="dueDate" value="#{task.dueDate}" datePattern="MMM d, yyyy HH:mm" rendered="#{task.assignee == authenticatedUser.cuid &amp;&amp; !task.inFinalStatus}" showWeeksBar="false" inputClass="mdw_value" buttonIcon="/images/sm_cal.gif" inputStyle="margin-top:-2px;" buttonClass="mdw_calendarBtn" />
              <!-- read-only due date -->
              <h:outputLabel for="dueDateReadOnly" value="Due:" rendered="#{task.assignee != authenticatedUser.cuid || task.inFinalStatus}" />
              <h:outputText id="dueDateReadOnly" value="#{task.dueDate}" rendered="#{task.assignee != authenticatedUser.cuid || task.inFinalStatus}" style="white-space:nowrap;">
                <f:convertDateTime pattern="MMM d, yyyy HH:mm" />
              </h:outputText>

              <h:outputLabel for="endDate" value="Completed:" />
              <h:outputText id="endDate" value="#{task.endDate}" style="white-space:nowrap;">
                <f:convertDateTime pattern="MMM d, yyyy HH:mm" />
              </h:outputText>
              
              <h:outputLabel for="processLink" value="Process:" rendered="#{task.ownerType == 'PROCESS_INSTANCE'}" />
              <h:outputLink id="processLink" value="#" rendered="#{task.ownerType == 'PROCESS_INSTANCE'}">
                #{task.processInstanceId} 
                <rich:componentControl for="processPanel" attachTo="processLink" operation="show" event="onclick"/>
              </h:outputLink>
              
              <h:outputLabel for="creator" value="Creator:" rendered="#{task.ownerType == 'USER'}" />
              <h:outputText id="creator" value="#{task.creator}" rendered="#{task.ownerType == 'USER'}" />

              <h:outputLabel for="priority" value="Priority:" />
              <h:outputText id="priority" value="#{task.priority}" styleClass="mdw_value" >
              </h:outputText>
   
              <h:commandLink id="taskTemplate"  action="#{taskTemplateActionController.displayTaskTemplate}" rendered="#{taskTemplateActionController.editableByCurrentUser}">
                Task Template
              </h:commandLink>
              <mdw:blank />
 
              <h:outputLabel for="description" value="Description:" />
              <t:panelGroup colspan="5">
                <pre style="padding:0;margin:0" class="mdw_value">
                  <t:outputText id="description" value="#{task.description}" escape="true" /></pre>
              </t:panelGroup>
              
              <h:outputLabel for="comments" value="Comments:" />
              <t:panelGroup colspan="5">
                <h:inputTextarea id="comments" wrap="off" value="#{task.comments}" rows="6"
                  readonly="#{task.assignee != authenticatedUser.cuid || task.inFinalStatus}" 
                  styleClass="mdw_textAreaInput #{(task.assignee != authenticatedUser.cuid || task.inFinalStatus) ? 'mdw_readOnly' : ''}" />
              </t:panelGroup>
  
            </t:panelGrid>
          </rich:panel>
        </ui:insert>
        
        <ui:insert name="taskMessage">
          <rich:panel header="Task Message" styleClass="mdw_defaultPanel" rendered="#{task.message != null}" style="width:800px;overflow:auto;">
            <t:panelGroup>
              <pre style="padding:0;margin:0;">
                <t:outputText id="message" value="#{task.message}" escape="true" /></pre>
            </t:panelGroup>
          </rich:panel>
        </ui:insert>
        
        <ui:insert name="customContent" />
        
      </div>
      
      <div align="left">
        <ui:insert name="taskData">
          <rich:panel header="Task Data" styleClass="mdw_defaultPanel" style="width:800px;" rendered="#{detailManager.taskDetail.hasInstanceDataItems}">
            <t:dataTable
              rendered="#{detailManager.taskDetail.hasInstanceDataItems}"
              columnClasses="mdw_label,mdw_value"
              value="#{detailManager.taskDetail.instanceDataItems}"
              var="instanceDataItem"
              rowIndexVar="dataItemRowIndex"
              width="100%">
              <t:column
                rendered="#{instanceDataItem.rendered}"
                style="width:100px;">
                <t:outputText            
                  value="#{instanceDataItem.dataKeyName}" />
                <t:outputText
                  rendered="#{instanceDataItem.valueEditable &amp;&amp; instanceDataItem.valueRequired}"
                  value=" *" style="color:red;"/>
              </t:column>
              <t:column
                rendered="#{instanceDataItem.rendered}"
                style="width:600px;">
                <mdw:field 
                  dataItem="#{instanceDataItem}"
                  dataItemSequenceId="#{dataItemRowIndex}" />
              </t:column>
            </t:dataTable>
          </rich:panel>
        </ui:insert>
      </div>            
      
    </ui:define>

    <ui:define name="actionContent">
      <t:inputHidden
        id="taskInstanceId" 
        immediate="true" 
        forceId="true" 
        name="taskInstanceId" 
        value="#{detailManager.taskDetail.instanceId}" />    
      <mdw:taskActionMenu
        id="taskDetailAction"
        menuBinding="#{detailManager.taskDetail.taskActionMenu}"
        rendered="#{(detailManager.taskDetail.taskAssignedToCurrentUser || detailManager.taskDetail.applicableForCurrentUsersWorkgroups) &amp;&amp; detailManager.taskDetail.anyValidTaskActions}"
        subformId="detailForm"
        applyTo="#{detailManager.taskDetail}"
        submitDetailData="true"
        optionalValidation="mainDetailForm:detailForm" />
    </ui:define>

    <ui:define name="commandContent">
      <t:inputHidden
        id="taskInstanceId" 
        immediate="true"        
        forceId="true" 
        name="taskInstanceId" 
        value="#{detailManager.taskDetail.instanceId}" />    
      <div align="right" style="width:545px;">
        <t:commandButton
          id="taskDetailSave"
          rendered="#{task.assignee == authenticatedUser.cuid &amp;&amp; !task.inFinalStatus}"
          value="Save"
          action="go_taskDetail"
          actionFor="detailForm"
          styleClass="mdw_detailFormButtons">
          <f:actionListener
            type="com.centurylink.mdw.taskmgr.ui.tasks.detail.TaskInstanceActionController">
          </f:actionListener>
        </t:commandButton>
      </div>
    </ui:define>

    <ui:define name="modalContent">
      <rich:modalPanel id="processPanel" width="800" height="600" trimOverlayedElements="false" rendered="#{task.ownerType == 'PROCESS_INSTANCE'}">
        <f:facet name="header">
          <t:panelGroup>
            <div style="height:14px;">
              <h:graphicImage value="/images/process.gif" />
              <h:outputText value="Process Instance" style="position:relative;top:-3px;left:2px;"/>
            </div>
          </t:panelGroup>
        </f:facet>
        <f:facet name="controls">
          <t:panelGroup>
            <h:form class="mdw_form">
              <table style="margin-top:-2px;">
                <tr>
                  <td>
                    <h:commandLink action="#{processDesignerView.launchDesigner}">
                      <h:graphicImage value="/images/designer.gif" title="MDW Designer" style="border:none;" />
                    </h:commandLink>
                  </td>
                  <td><h:graphicImage value="/images/close.png" styleClass="hidelink" id="hideProcessPanelLink" /></td>
                </tr>
              </table>
            </h:form>
            <rich:componentControl for="processPanel" attachTo="hideProcessPanelLink" operation="hide" event="onclick" />
          </t:panelGroup>
        </f:facet>
        <div style="height:99%;width:99%;overflow:auto;">
          <t:graphicImage
            value="#{detailManager.taskDetail.workflowSnapshotUrl}"
            alt="Workflow Image" />
        </div>
      </rich:modalPanel>
    </ui:define>
  </ui:composition>

</html>