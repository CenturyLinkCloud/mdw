<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:a4j="http://richfaces.org/a4j"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:mdw="http://www.centurylink.com/mdw/jsf">
  
  <ui:composition template="/facelets/layout/main.xhtml">

    <ui:define name="content">
    
      <ui:param name="renderHeaderMessages" value="false" />
    
      <script language="javascript">
      function updateImage(imgId)
      {
        var img = document.getElementById(imgId);
        img.src = img.src;
      }
      function loadView()
      {
        document.getElementById('adminDetailPanelGroup').innerHTML = '';
        var viewLoadImg = document.getElementById('viewLoadingImg');
        viewLoadImg.style.display = 'inline';
        setTimeout('updateImage("viewLoadingImg");', 25);
      }
      function stopProp(e)
      {
        if (e &amp;&amp; e.stopPropagation)
          e.stopPropagation();
        else
          event.cancelBubble=true;
      }
      </script>

      <table
        cellpadding="0" 
        cellspacing="3px"
        style="border-collapse:separate;border-spacing:3px;padding:2px;"  
        width="100%" 
        class="mdw_tabbedContent">
        <tr>
          <td valign="top" class="mdw_panelBorderLeft">
            <h:form id="treeForm" style="mdw_form">          
              <mdw:panelContainer id="togglePanelContainer">
                <mdw:togglePanel
                  id="adminPanel"
                  switchType="client"
                  refreshAction="#{workgroupTree.refresh}"
                  headerClass="mdw_panelHeaderInner"
                  closedHeaderClass="mdw_panelHeaderInnerClosed"
                  closedHeaderImage="/images/workgroups90deg_lg.gif"
                  bodyClass="mdw_panelBodyInner"
                  styleClass="mdw_togglePanelInner">
                  <f:facet name="header">
                    <h:panelGroup id="adminPanelTreeHeader">
                      <h:outputText value="Workgroups" style="position:relative;top:-3px;"/>
                      <h:graphicImage
                        value="/images/refresh.gif"
                        title="Refresh" 
                        alt="Refresh"
                        styleClass="mdw_toolbarBtn"
                        onclick="document.getElementById('treeForm:adminPanel_header').onclick=''; document.getElementById('adminDetailPanelGroup').style.display='none'; document.getElementById('treeForm:groupTree').style.display='none'; document.getElementById('treeForm:treeLoadingImage').style.display='inline'; setTimeout('updateImage(\'treeForm:treeLoadingImage\');',50); document.getElementById('treeForm:refreshBtn').click();" />
                      <h:commandButton
                        id="refreshBtn" 
                        action="#{workgroupTree.refresh}" 
                        style="display:none;height:0px;width:0px;" />
                      <a4j:commandLink
                        ajaxSingle="true" 
                        rendered="#{authenticatedUser.roles['User Admin']}"
                        reRender="addDlg" 
                        style="margin-left:85px;" 
                        onclick="stopProp(event);return false;">
                        <h:graphicImage id="add" value="/images/add.gif" title="New..." alt="New..." styleClass="mdw_toolbarBtn">
                          <rich:componentControl for="addDlg" attachTo="add" operation="show" event="onclick" />
                        </h:graphicImage>
                      </a4j:commandLink>
                      <a4j:commandLink 
                        ajaxSingle="true" 
                        rendered="#{workgroupTree.userAllowedToEditSelection}"
                        reRender="deleteDlg" 
                        onclick="stopProp(event);return false;">
                        <h:graphicImage id="delete" value="/images/delete.gif" title="Delete" alt="Delete" styleClass="mdw_toolbarBtn">
                          <rich:componentControl for="deleteDlg" attachTo="delete" operation="show" event="onclick" />
                        </h:graphicImage>
                      </a4j:commandLink>
                    </h:panelGroup>
                  </f:facet>

                  <rich:tree
                    id="groupTree"
                    switchType="ajax"
                    value="#{workgroupTree.treeNode}"
                    var="treeItem"
                    nodeFace="#{treeItem.title}"
                    stateAdvisor="#{workgroupTree}">
                    <rich:treeNode
                      type="Workgroup"
                      iconLeaf="/images/group.gif"
                      icon="/images/group.gif">
                      <h:outputText value="#{treeItem.groupName}" />
                      <a4j:support event="onselected" ajaxSingle="true" reRender="adminDetailPanel,adminPanelTreeHeader" onsubmit="document.getElementById('selectedEntityTitle').innerHTML='';">
                        <f:setPropertyActionListener value="#{treeItem}" target="#{workgroupTree.group}" />
                      </a4j:support>
                    </rich:treeNode>
                    <rich:treeNode
                      type="User"
                      iconLeaf="/images/person.gif"
                      icon="/images/person.gif">
                      <h:outputText value="#{treeItem.name}" />
                      <a4j:support event="onselected" ajaxSingle="true" reRender="adminDetailPanel,adminPanelTreeHeader" onsubmit="document.getElementById('selectedEntityTitle').innerHTML='';">
                        <f:setPropertyActionListener value="#{treeItem}" target="#{workgroupTree.scopedUser}" />
                      </a4j:support>        
                    </rich:treeNode>
                  </rich:tree>
                  <div align="center" style="margin-top:10px;">
                    <h:graphicImage
                      id="treeLoadingImage"
                      value="/images/loading.gif"
                      style="display:none;" />
                  </div>
                </mdw:togglePanel>
              </mdw:panelContainer>
            </h:form>
          </td>
  
          <td valign="top" width="100%" height="100%" class="mdw_panelBorderLeft">
            <rich:panel id="adminDetailPanel"
                headerClass="mdw_panelHeaderInner mdw_panelHeaderBottomBorder"
                styleClass="mdw_richPanelUnbordered"
                bodyClass="mdw_richPanelBody"
                style="height:550px;">
              <f:facet name="header">
                <h:panelGrid columns="2" cellpadding="0" cellspacing="0" columnClasses="mdw_left,mdw_right">              
                  <h:outputText id="selectedEntityTitle" value="#{workgroupTree.selectedTitle}" />
                  <h:form>
                    <a4j:commandLink ajaxSingle="true" reRender="adminDetailPanel" action="#{workgroupTree.userList}">
                      <h:graphicImage value="/images/users.gif" title="Users" alt="Users" styleClass="mdw_toolbarBtn" />
                    </a4j:commandLink>                  
                    <a4j:commandLink ajaxSingle="true" reRender="adminDetailPanel" action="#{workgroupTree.groupList}">
                      <h:graphicImage value="/images/group.gif" title="Groups" alt="Groups" styleClass="mdw_toolbarBtn" />
                    </a4j:commandLink>
                    <a4j:commandLink ajaxSingle="true" reRender="adminDetailPanel" action="#{workgroupTree.roleList}">
                      <h:graphicImage value="/images/roles.gif" title="Roles" alt="Roles" styleClass="mdw_toolbarBtn" />
                    </a4j:commandLink>
                    <a4j:commandLink ajaxSingle="true" reRender="adminDetailPanel" action="#{workgroupTree.taskList}">
                      <h:graphicImage value="/images/tasks.gif" title="Tasks" alt="Tasks" styleClass="mdw_toolbarBtn" />
                    </a4j:commandLink>                  
                    <a4j:commandLink ajaxSingle="true" reRender="adminDetailPanel" action="#{workgroupTree.assetList}">
                      <h:graphicImage value="/images/assets.gif" title="Assets" alt="Assets" styleClass="mdw_toolbarBtn" />
                    </a4j:commandLink>
                    <a4j:commandLink ajaxSingle="true" reRender="adminDetailPanel" action="#{workgroupTree.historyList}">
                      <h:graphicImage value="/images/history.gif" title="History" alt="History" styleClass="mdw_toolbarBtn" />
                    </a4j:commandLink>                  
                  </h:form>
                </h:panelGrid>
              </f:facet>
              
              <h:graphicImage id="viewLoadingImg" style="margin-left:5px;display:none;" value="/images/viewLoading.gif" />

              <a4j:status>
                <f:facet name="start">
                  <h:graphicImage style="margin-left:5px;" value="/images/detailLoading.gif" />
                </f:facet>
                <f:facet name="stop">
                  <h:panelGroup id="adminDetailPanelGroup">
                    <a4j:region rendered="#{workgroupTree.displayList == null &amp;&amp; workgroupTree.scopedUser != null}">
                      <ui:include src="groupUser.xhtml" />
                    </a4j:region>
                    <a4j:region rendered="#{workgroupTree.displayList == null &amp;&amp; workgroupTree.user != null}">
                      <ui:include src="user.xhtml" />
                    </a4j:region>
                    <a4j:region rendered="#{workgroupTree.displayList == null &amp;&amp; (workgroupTree.group != null || (workgroupTree.addMode &amp;&amp; workgroupTree.addType == 'Group'))}">
                      <ui:include src="group.xhtml" />
                    </a4j:region>
                    <a4j:region rendered="#{workgroupTree.displayList == null &amp;&amp; workgroupTree.role != null}">
                      <ui:include src="role.xhtml" />
                    </a4j:region>   
                    <a4j:region rendered="#{workgroupTree.displayList == null &amp;&amp; workgroupTree.task != null}">
                      <ui:include src="task.xhtml" />
                    </a4j:region> 
                   <a4j:region rendered="#{workgroupTree.displayList == 'Assets'}">
                      <ui:include src="assetList.xhtml" />
                    </a4j:region>                 
                    <a4j:region rendered="#{workgroupTree.displayList == 'Users'}">
                      <ui:include src="userList.xhtml" />
                    </a4j:region>
                    <a4j:region rendered="#{workgroupTree.displayList == 'Groups'}">
                      <ui:include src="groupList.xhtml" />
                    </a4j:region>                    
                    <a4j:region rendered="#{workgroupTree.displayList == 'Roles'}">
                      <ui:include src="roleList.xhtml" />
                    </a4j:region> 
                    <a4j:region rendered="#{workgroupTree.displayList == 'Tasks'}">
                      <ui:include src="taskList.xhtml" />
                    </a4j:region>                   
                    <a4j:region rendered="#{workgroupTree.displayList == 'History'}">
                      <ui:include src="historyList.xhtml" />
                    </a4j:region>                    
                    <a4j:outputPanel ajaxRendered="true">
                      <h:messages rendered="#{workgroupTree.selection == null &amp;&amp; !workgroupTree.addMode}" 
                        showDetail="true" 
                        globalOnly="true" 
                        styleClass="mdw_message" 
                        style="margin-left:10px;" />
                    </a4j:outputPanel>
                    <a4j:region rendered="#{workgroupTree.selection != null}">
                      <ui:include src="deleteDlg.xhtml" />
                    </a4j:region>
                    <ui:include src="addDlg.xhtml" />
                    <a4j:region rendered="#{workgroupTree.deletePending}">
                      <script language="javascript">
                      #{rich:component('deleteDlg')}.show();
                      </script>
                    </a4j:region>
                         <a4j:region rendered="#{workgroupTree.showImport}">
				        <script language="javascript">
				        #{rich:component('assetImportModalPanel')}.show();
				        </script>
				     </a4j:region>
				     <a4j:region rendered="#{workgroupTree.showExport}">
				        <script language="javascript">
				        #{rich:component('assetExportModalPanel')}.show();
				        </script>
				     </a4j:region>  
                    <a4j:region rendered="#{workgroupTree.displayList != null &amp;&amp; mdwListId != null}">
                      <mdw:listPrefs prefsController="#{userPrefs}" />
                    </a4j:region>
                  </h:panelGroup>
                </f:facet>
              </a4j:status>                    
            </rich:panel>
          </td>
        </tr>
      </table>
      
    </ui:define>
    
  </ui:composition>
  
</html>