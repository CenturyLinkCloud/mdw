##### Server Configuration #####

ServerRoot "/opt/apache/mdwadmin-50805/server"
#Listen 50805

#Set the timeout to longest possible transaction time
#Tune KeepAliveTimeout to Average page Load time
Timeout 300
KeepAlive On
MaxKeepAliveRequests 500
KeepAliveTimeout 15

User nobody
Group nobody
ServerAdmin donald.oakes@qwest.com
ServerName lxdenvmtc144.dev.qintra.com
UseCanonicalName Off

# WORKER
# ThreadsPerChild = 20 threads for sites <100 users, 60 for sites < 300, and 120 for sites > 300
# ThreadLimit = ThreadsPerChild
# MaxSpareThreads should be 3X ThreadsPerChild to avoid child processes getting killed prematurely
# MaxClients = (ThreadsPerChild * ServerLimit)
# ServerLimit = maximum # of processes to allow
# MaxRequestsPerChild = total # of requests a processes handles before getting recycled. 0 is unlimited
<IfModule worker.c>
ThreadLimit         20
StartServers         1
MaxClients         120
MinSpareThreads      5
MaxSpareThreads     60
ThreadsPerChild     20
ServerLimit          6
MaxRequestsPerChild  0
</IfModule>

# PREFORK
# TIP:  For the best performance keep ServerLimit = MaxClients.  
# StartServer = # of concurrent users (prod divide by 3)

# ServerLimit: maximum value for MaxClients
# MaxClients: maximum number of server processes allowed to start
# MaxRequestsPerChild: maximum number of requests a server process serves
<IfModule prefork.c>
StartServers            8
MinSpareServers         5
MaxSpareServers        20
ServerLimit           256
MaxClients            256
MaxRequestsPerChild  4000
</IfModule>

DirectoryIndex index.html index.html.var
TypesConfig conf/mime.types
DefaultType text/plain
HostnameLookups Off
EnableMMAP off
EnableSendfile off
# Logging
ErrorLog logs/error_log
LogLevel error
ExtendedStatus Off

ServerTokens Prod
ServerSignature Off
# Default indexing
IndexOptions VersionSort
# Disable Trace
TraceEnable Off

##### Load Modules into Apache Here... #####
LoadModule authz_host_module modules/mod_authz_host.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule mime_module modules/mod_mime.so
LoadModule status_module modules/mod_status.so
LoadModule autoindex_module modules/mod_autoindex.so
LoadModule vhost_alias_module modules/mod_vhost_alias.so
LoadModule negotiation_module modules/mod_negotiation.so
LoadModule dir_module modules/mod_dir.so
LoadModule alias_module modules/mod_alias.so
LoadModule setenvif_module modules/mod_setenvif.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule headers_module modules/mod_headers.so
LoadModule ssl_module modules/mod_ssl.so
#LoadModule security2_module  /opt/apache/current/modules/mod_security2.so
#LoadModule unique_id_module modules/mod_unique_id.so

# PROXIES (weblogic, cleartrust, tomcat, generic proxy, and proxy_html)
#LoadModule weblogic_module  /opt/apache/current/modules/mod_wl_22_latest_version.so
LoadModule ct_auth_module  /opt/apache/current/modules/libct_apache22_agent.so
#LoadModule jk_module modules/mod_jk.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so 
LoadModule proxy_balancer_module modules/mod_proxy_balancer.so
LoadModule proxy_connect_module modules/mod_proxy_connect.so
#LoadModule proxy_ajp_module modules/mod_proxy_ajp.so
#LoadModule proxy_ftp_module modules/mod_proxy_ftp.so
# Proxy_html requires libxml2 to be installed, xml2enc.so, & proxy_html.so
#LoadFile /usr/lib64/libxml2.so
#LoadModule xml2enc_module  /opt/apache/current/modules/mod_xml2enc.so
#LoadModule proxy_html_module  /opt/apache/current/modules/mod_proxy_html.so 

# PERFORMANCE
#LoadModule deflate_module modules/mod_deflate.so
#LoadModule expires_module modules/mod_expires.so
#LoadModule cache_module modules/mod_cache.so
#LoadModule disk_cache_module modules/mod_disk_cache.so
#LoadModule file_cache_module modules/mod_file_cache.so
#LoadModule mem_cache_module modules/mod_mem_cache.so
# AUTH
#LoadModule auth_basic_module modules/mod_auth_basic.so
#LoadModule auth_digest_module modules/mod_auth_digest.so
#LoadModule authn_file_module modules/mod_authn_file.so
#LoadModule authn_alias_module modules/mod_authn_alias.so
#LoadModule authn_anon_module modules/mod_authn_anon.so
#LoadModule authn_dbm_module modules/mod_authn_dbm.so
#LoadModule authn_default_module modules/mod_authn_default.so
#LoadModule authz_user_module modules/mod_authz_user.so
#LoadModule authz_owner_module modules/mod_authz_owner.so
#LoadModule authz_groupfile_module modules/mod_authz_groupfile.so
#LoadModule authz_dbm_module modules/mod_authz_dbm.so
#LoadModule authz_default_module modules/mod_authz_default.so
#LoadModule ldap_module modules/mod_ldap.so
#LoadModule authnz_ldap_module modules/mod_authnz_ldap.so
# OTHER
#LoadModule include_module modules/mod_include.so
#LoadModule logio_module modules/mod_logio.so
#LoadModule env_module modules/mod_env.so
#LoadModule ext_filter_module modules/mod_ext_filter.so
#LoadModule mime_magic_module modules/mod_mime_magic.so
#LoadModule usertrack_module modules/mod_usertrack.so
#LoadModule dav_module modules/mod_dav.so
#LoadModule info_module modules/mod_info.so
#LoadModule dav_fs_module modules/mod_dav_fs.so
#LoadModule actions_module modules/mod_actions.so
#LoadModule speling_module modules/mod_speling.so
#LoadModule userdir_module modules/mod_userdir.so
#LoadModule suexec_module modules/mod_suexec.so
#LoadModule cgi_module modules/mod_cgi.so
#LoadModule version_module modules/mod_version.so
#LoadModule cern_meta_module modules/mod_cern_meta.so
#LoadModule asis_module modules/mod_asis.so

#Secure Root Directory Access
<Directory />
    Order Deny,Allow
    deny from all
	Options None
    AllowOverride None
</Directory>

##### Document Root #####
DocumentRoot /opt/apache/mdwadmin-50805/server/htdocs
<Directory "/opt/apache/mdwadmin-50805/server/htdocs">
    Options FollowSymLinks
    AllowOverride None
    Order allow,deny
    Allow from all
</Directory>

##### Error Pages #####
Alias /error "/opt/apache/ibm/htdocs/error"
 <Directory "/opt/apache/ibm/htdocs/error">
    Options FollowSymLinks
    AllowOverride None
    Order allow,deny
    Allow from all
 </Directory>

ErrorDocument 404 /error/404.html

#####  mod_security #####
<IfModule mod_security2.c>
        Include conf/extras/modsecurity*.conf
        Include  /opt/apache/current/modules/base_rules/*conf
</IfModule>

##### RSA ClearTrust #####

# SETUP Cleartrust
# Contact the cleartrust team and have a "cleartrust.agent.web_server_name" created 
# for your project so you can configure specific cleartrust entitlements.  
# Once completed you will need to update the webagent.conf with that value.
#	cleartrust.agent.web_server_name=$value_from_cleartrust_team
<IfModule ct_apache_mod.c>
    CTAgentRoot /opt/apache/mdwadmin-50805/server
    Alias /cleartrust/ "/opt/apache/mdwadmin-50805/server/htdocs/ctrust/"
  <Directory "/opt/apache/mdwadmin-50805/server/htdocs/ctrust/">
    AuthType Basic
    Require valid-user
    AuthName CT
  </Directory>
  <Location /mdwadmin>
    AuthType Basic
    Require valid-user
    AuthName CT
  </Location>
</IfModule>

##### Tomcat MOD JK ##### 
<IfModule mod_jk.c>
 JkWorkersFile "conf/extras/workers.properties"
 JkMountFile "conf/extras/uriworkermap.properties"
 # Default shared memory file used for loadbalancing
 JkShmFile logs/jk-runtime-status
 JkWatchdogInterval 60

 # LOGGING: mod_jk proxy log settings [debug/error/info]
 JkLogFile "logs/mod_jk.log"
 JkLogLevel error
 JkLogStampFormat    "[%a %b %d %H:%M:%S %Y] "
 JkRequestLogFormat  "%R %V %U %T %H %m %q %s"

 # JkOptions:
 #  +ForwardKeySize - will forward the SSH key size which is required by Servlet API 2.3
 #  +ForwardURIProxy - Default, compatible with URL manipulation by mod_rewrite
 #     and with URL encoded session ids.
 #  +ForwardLocalAddress - Sends address of local web server instead of client.
 #     This with tomcat remote address valve's can force all traffic through web server.
 JkOptions ForwardLocalAddress
</IfModule>

 ##### Tomcat Mod Proxy AJP for HTTP #####
 <IfModule mod_proxy_ajp.c>
 #  Include conf/extras/proxy_ajp.conf
 </IfModule>

 ##### Mod Proxy HTTP #####
 <IfModule mod_proxy.c>
   Include conf/extras/proxy.conf
 </IfModule>

##### Monitor Server Status #####
#<IfModule mod_status.c>
#   <Location /server-status>
#        SetHandler server-status
#        Order deny,allow
#        Allow from all
#    </Location> 

#    <Location /balancer-manager>
#        SetHandler balancer-manager
#        Order deny,allow
#        Allow from all
#    </Location> 

# </IfModule> 
#NOTE: balancer-manager supports mod_proxy & mod_proxy_ajp 

##### CACHING #####
# http://httpd.apache.org/docs/2.2/mod/mod_cache.html
#
# This default config is designed to enable caching for all objects
# with or without Caching being set in the HTML.  We are manually
# setting things to expire after 8 hours (28800 sec). If the application
# is setting these values in the HTML comment out CacheIgnoreNoLastMod On
# and dont load mod_expires.
#
# If you experience content problems try removing the cache at /opt/apache/cache/ibm/mdwadmin-50805.  No restart is necessary.

<IfModule mod_cache.c>
    <IfModule mod_disk_cache.c>
        CacheRoot  /opt/apache/cache/ibm/mdwadmin-50805
        CacheEnable disk /
	# FORCE caching for all requests (without Cache-Control: no-cache)
	# If Last-Modified header is removed you need to set this to ON to cache
        CacheIgnoreNoLastMod On
        #CacheDisable /Homepage/images/btn_promo_over.gif
	#Uncomment CacheIgnoreHeaders when mod_cache is enabled. This is a workaround for Warning <Config> - Trusted domain list is empty when using webagent.conf
		#CacheIgnoreHeaders Set-Cookie Set-Cookie2
    </IfModule>
    <IfModule mod_mem_cache.c>
       CacheEnable mem /
       CacheEnable mem http://
       MCacheSize 8192
       MCacheMaxObjectCount 1000
       MCacheMinObjectSize 1
       MCacheMaxObjectSize 1000000
       # Cache for 5 minutes by default
       #CacheDefaultExpire 300
       # FORCE caching for all requests (without Cache-Control: no-cache)
       CacheIgnoreNoLastMod On
    </IfModule>
    <IfModule mod_expires.c>
        # Add expires headers for images, css & js files
        # reduces the number of requests that hit the server
		ExpiresActive On
		ExpiresDefault 28800
		ExpiresByType image/gif A28800
        ExpiresByType image/jpeg A28800
        ExpiresByType image/png A28800
        ExpiresByType image/x-icon A28800
		ExpiresByType text/plain
        ExpiresByType text/css A28800
        ExpiresByType text/javascript A28800
        ExpiresByType application/x-javascript A28800
 		ExpiresByType application/x-shockwave-flash A28800 
        ExpiresByType application/javascript A28800
        ExpiresByType application/ecmascript A28800
    </IfModule>
</IfModule>

##### DEFLATE #####

# To maximize performance compress your data before sending it to the client.
# You can do this with mod_deflate.  Be careful not to compress content that 
# is already compressed or in a special binary format like pictures and pdf's.
<IfModule mod_deflate.c>
        #Compress all output
        SetOutputFilter DEFLATE

        #Compress level Highest 9 - Lowest 1
        DeflateCompressionLevel 5

        #Skip browsers with known problems
        BrowserMatch ^Mozilla/4 gzip-only-text/html
        BrowserMatch ^Mozilla/4\.0[678] no-gzip
        BrowserMatch \bMSIE !no-gzip !gzip-only-text/html

        #Skip compress for certain component
        SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png)$ no-gzip dont-vary
        SetEnvIfNoCase Request_URI \.(?:pdf|swf)$ no-gzip dont-vary

		# Don't compresss dyncamic pdf output for specific regular context path.
    	#SetEnvIfNoCase Request_URI /mdwReports/retrievePDF\.do(.*) no-gzip dont-vary

        # Make sure proxies don't deliver the wrong content
        Header append Vary User-Agent env=!dont-vary

        #DeflateFilterNote ratio
        #LogFormat '"%r" %b (%{ratio}n) "%{User-agent}i"' deflate
        #CustomLog logs/deflate_info_log deflate
</IfModule>

#####  proxy_html  #####

# Production Support Team Waiver Required before you can use this module!  
# This module is a filter that will search for text in the final HTML your application 
# produces to the end user and replace it.  This is particulary useful if you want to deliver 
# HTML with production links and have them rewritten to test ones on the fly. It can also be 
# used in various proxy senarios where the URL needs to change for outside clients.
# Place your rules at the bottom of extras/proxy_html.conf
<IfModule mod_proxy_html.c>
        ProxyHTMLEnable On
        ProxyHTMLLogVerbose On
        Include conf/extras/proxy_html.conf
</IfModule>

##### SSI - Remember to add 'Includes' to the 'Options' directive #####
<IfModule mod_include.c>
	AddType text/html .shtml
	AddOutputFilter INCLUDES .shtml
</IfModule>

##### Rewrite Rules #####
<IfModule mod_rewrite.c>
	RewriteEngine On
    Include conf/extras/rewrite.conf
</IfModule>

##### Redirects and Aliases #####
<IfModule mod_alias.c>
    Include conf/extras/redirect.conf
</IfModule>

<IfModule mod_mime_magic.c>
    MIMEMagicFile conf/magic
</IfModule>

##### Load ssl.conf #####
<IfModule mod_ssl.c>
    Include conf/ssl.conf
</IfModule>

<IfModule !mpm_netware.c>
PidFile logs/httpd.pid
</IfModule>

#
##### Logging #####
#

LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
LogFormat "%h %l %u %t \"%r\" %>s %b" common
LogFormat "%{Referer}i -> %U" referer
LogFormat "%{User-agent}i" agent

# You need to enable mod_logio.c to use %I and %O
#LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O" combinedio

## Standard access log that does not log requests from specific IP's (ex: Network load balancers)
SetEnvIf Remote_Addr "(155\.70\.40\.25|155\.70\.40\.26|155\.70\.32\.25|155\.70\.32\.26|10\.1\.16\.10|10\.1\.16\.11|10\.1\.17\.10|10\.1\.17\.11|10\.1\.18\.10|10\.1\.18\.11|10\.1\.19\.10|10\.1\.19\.11|151\.116\.4\.10|151\.116\.4\.11|155\.70\.21\.11|155\.70\.21\.12|155\.70\.21\.18|155\.70\.21\.19|151\.117\.35\.253|151\.117\.35\.254|151\.117\.76\.149|151\.117\.76\.150|10\.6\.66\.119|10\.6\.66\.120|10\.6\.67\.197|10\.6\.67\.198|10\.6\.68\.248|10\.6\.68\.249|151\.117\.79\.135|151\.117\.79\.136|155\.70\.58\.9|155\.70\.58\.10|155\.70\.62\.3|155\.70\.62\.4|155\.70\.49\.9|155\.70\.49\.10|155\.70\.16\.6|155\.70\.16\.7|151\.117\.5\.9|151\.117\.5\.10|10\.6\.60\.31|10\.6\.60\.32|151\.117\.6\.9|151\.117\.6\.10|10\.6\.65\.12|10\.6\.65\.13|151\.119\.93\.4|151\.119\.93\.5|10\.0\.55\.56|10\.0\.55\.57)" netrequests
CustomLog logs/access_log common env=!netrequests

## If we wanted to log the network requests to the log file network_reqs_log
#CustomLog logs/network_reqs_log common env=netrequests

## Custom log to capture Apache webserver response times for non network requests
LogFormat "%D\t%U%q" responseTime
#CustomLog logs/responseTimes_log responseTime env=!netrequests

AddIconByEncoding (CMP,/icons/compressed.gif) x-compress x-gzip

AddIconByType (TXT,/icons/text.gif) text/*
AddIconByType (IMG,/icons/image2.gif) image/*
AddIconByType (SND,/icons/sound2.gif) audio/*
AddIconByType (VID,/icons/movie.gif) video/*

AddIcon /icons/binary.gif .bin .exe
AddIcon /icons/binhex.gif .hqx
AddIcon /icons/tar.gif .tar
AddIcon /icons/world2.gif .wrl .wrl.gz .vrml .vrm .iv
AddIcon /icons/compressed.gif .Z .z .tgz .gz .zip
AddIcon /icons/a.gif .ps .ai .eps
AddIcon /icons/layout.gif .html .shtml .htm .pdf
AddIcon /icons/text.gif .txt
AddIcon /icons/c.gif .c
AddIcon /icons/p.gif .pl .py
AddIcon /icons/f.gif .for
AddIcon /icons/dvi.gif .dvi
AddIcon /icons/uuencoded.gif .uu
AddIcon /icons/script.gif .conf .sh .shar .csh .ksh .tcl
AddIcon /icons/tex.gif .tex
AddIcon /icons/bomb.gif core

AddIcon /icons/back.gif ..
AddIcon /icons/hand.right.gif README
AddIcon /icons/folder.gif ^^DIRECTORY^^
AddIcon /icons/blank.gif ^^BLANKICON^^

DefaultIcon /icons/unknown.gif

ReadmeName README.html
HeaderName HEADER.html

IndexIgnore .??* *~ *# HEADER* README* RCS CVS *,v *,t

AddLanguage ca .ca
AddLanguage cs .cz .cs
AddLanguage da .dk
AddLanguage de .de
AddLanguage el .el
AddLanguage en .en
AddLanguage eo .eo
AddLanguage es .es
AddLanguage et .et
AddLanguage fr .fr
AddLanguage he .he
AddLanguage hr .hr
AddLanguage it .it
AddLanguage ja .ja
AddLanguage ko .ko
AddLanguage ltz .ltz
AddLanguage nl .nl
AddLanguage nn .nn
AddLanguage no .no
AddLanguage pl .po
AddLanguage pt .pt
AddLanguage pt-BR .pt-br
AddLanguage ru .ru
AddLanguage sv .sv
AddLanguage zh-CN .zh-cn
AddLanguage zh-TW .zh-tw

LanguagePriority en ca cs da de el eo es et fr he hr it ja ko ltz nl nn no pl pt pt-BR ru sv zh-CN zh-TW

ForceLanguagePriority Prefer Fallback

AddDefaultCharset ISO-8859-1

AddCharset ISO-8859-1  .iso8859-1  .latin1
AddCharset ISO-8859-2  .iso8859-2  .latin2 .cen
AddCharset ISO-8859-3  .iso8859-3  .latin3
AddCharset ISO-8859-4  .iso8859-4  .latin4
AddCharset ISO-8859-5  .iso8859-5  .latin5 .cyr .iso-ru
AddCharset ISO-8859-6  .iso8859-6  .latin6 .arb
AddCharset ISO-8859-7  .iso8859-7  .latin7 .grk
AddCharset ISO-8859-8  .iso8859-8  .latin8 .heb
AddCharset ISO-8859-9  .iso8859-9  .latin9 .trk
AddCharset ISO-2022-JP .iso2022-jp .jis
AddCharset ISO-2022-KR .iso2022-kr .kis
AddCharset ISO-2022-CN .iso2022-cn .cis
AddCharset Big5        .Big5       .big5
AddCharset WINDOWS-1251 .cp-1251   .win-1251
AddCharset CP866       .cp866
AddCharset KOI8-r      .koi8-r .koi8-ru
AddCharset KOI8-ru     .koi8-uk .ua
AddCharset ISO-10646-UCS-2 .ucs2
AddCharset ISO-10646-UCS-4 .ucs4
AddCharset UTF-8       .utf8

AddCharset GB2312      .gb2312 .gb
AddCharset utf-7       .utf7
AddCharset utf-8       .utf8
AddCharset big5        .big5 .b5
AddCharset EUC-TW      .euc-tw
AddCharset EUC-JP      .euc-jp
AddCharset EUC-KR      .euc-kr
AddCharset shift_jis   .sjis

AddType application/x-compress .Z
AddType application/x-gzip .gz .tgz

AddHandler type-map var

BrowserMatch "Mozilla/2" nokeepalive
BrowserMatch "MSIE 4\.0b2;" nokeepalive downgrade-1.0 force-response-1.0
BrowserMatch "RealPlayer 4\.0" force-response-1.0
BrowserMatch "Java/1\.0" force-response-1.0
BrowserMatch "JDK/1\.0" force-response-1.0

BrowserMatch "Microsoft Data Access Internet Publishing Provider" redirect-carefully
BrowserMatch "MS FrontPage" redirect-carefully
BrowserMatch "^WebDrive" redirect-carefully
BrowserMatch "^WebDAVFS/1.[0123]" redirect-carefully
BrowserMatch "^gnome-vfs/1.0" redirect-carefully
BrowserMatch "^XML Spy" redirect-carefully
BrowserMatch "^Dreamweaver-WebDAV-SCM1" redirect-carefully

